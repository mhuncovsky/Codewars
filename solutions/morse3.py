#! python3


MORSE_CODE = {
    '.-...': '&', '--..--': ',', '....-': '4', '.....': '5',
    '...---...': 'SOS', '-...': 'B', '-..-': 'X', '.-.': 'R',
    '.--': 'W', '..---': '2', '.-': 'A', '..': 'I', '..-.': 'F',
    '.': 'E', '.-..': 'L', '...': 'S', '..-': 'U', '..--..': '?',
    '.----': '1', '-.-': 'K', '-..': 'D', '-....': '6',
    '-...-': '=', '---': 'O', '.--.': 'P', '.-.-.-': '.',
    '--': 'M', '-.': 'N', '....': 'H', '.----.': "'",
    '...-': 'V', '--...': '7', '-.-.-.': ';', '-....-': '-',
    '..--.-': '_', '-.--.-': ')', '-.-.--': '!', '--.': 'G',
    '--.-': 'Q', '--..': 'Z', '-..-.': '/', '.-.-.': '+',
    '-.-.': 'C', '---...': ':', '-.--': 'Y', '-': 'T',
    '.--.-.': '@', '...-..-': '$', '.---': 'J', '-----': '0',
    '----.': '9', '.-..-.': '"', '-.--.': '(', '---..': '8',
    '...--': '3'
}

ALPHA = {v: k for k, v in MORSE_CODE.items()}


# pause between dots/dashes 0, chars 000, words 0000000

def encode(s):
    from struct import unpack
    morse = ''.join('0'.join(ALPHA[x]) + '000' if x != ' '
                    else '0000' for x in s.upper()).replace(
        '.', '1').replace('-', '111')[:-3]
    morse += (32 - len(morse) % 32) * '0'
    morse = bytes([int(morse[i:i + 8], 2) for i in range(0, len(morse), 8)])
    return unpack('>' + 'i' * (len(morse) // 4), morse)


def decode(ilist):
    from struct import pack
    bits = pack('>' + 'i' * len(ilist), *ilist)
    bits = ''.join('{:0>8}'.format(bin(x)[2:]) for x in bits).strip('0')
    bits = bits.replace('1' * 3, '-').replace('1', '.')
    bits = bits.replace('0' * 7, '   ').replace('0' * 3, ' ').replace('0', '')
    words = [word.split() for word in bits.split('   ')]
    return ' '.join(''.join(MORSE_CODE[c] for c in word if c)
                    for word in words if word)


# def decodeMorse(morseCode):
#     words = [word.split() for word in morseCode.split('   ')]
#     return ' '.join(''.join(MORSE_CODE[c] for c in word if c)
#                     for word in words if word)


def decodeBits(bits):
    bits = bits.strip('0')
    rate = set(len(x) for x in bits.split('0') if x).union(
        set(len(x) for x in bits.split('1') if x))
    if len(rate) > 1:
        rate = min(rate)
    else:
        rate = rate.pop()

    print(rate, bits)
    bits = bits.replace('0' * rate, '0').replace('1' * rate, '1')
    bits = bits.replace('0' * 7, '   ')
    bits = bits.replace('0' * 3, ' ')
    bits = bits.replace('1' * 3, '-').replace('1', '.')
    bits = bits.replace('0', '')
    return bits


def kmeans(k, data, iters=5):
    from math import sqrt
    clusters = []
    for i in range(k):
        m = k / (i + 1) * mean(data)
        d = [x for x in data if x < m]
        m = mean(d)
        clusters.append([m, d])
    clusters[0][0] = min(data)
    clusters[-1][0] = max(data)
    for i in range(iters):
        for c in clusters:
            c[1] = []
        for x in data:
            dist = []
            for j in range(k):
                dist.append(sqrt(abs(x ** 2 - clusters[j][0] ** 2)))
            clusters[dist.index(min(dist))][1].append(x)
        for c in clusters:
            c[0] = mean(c[1])
    return sorted([c[0] for c in clusters])


def mean(x):
    return sum(x) / len(x) if x else 0


def decodeBitsAdvanced(bits):
    bits = bits.strip('0')
    ones = [float(len(x)) for x in bits.split('0') if x][::-1]
    zeros = [float(len(x)) for x in bits.split('1') if x][::-1]

    if not ones:
        return ''
    if len(ones) < 10:
        ret = short(ones, zeros)
    else:
        cc0 = kmeans(3, zeros)
        cc1 = kmeans(2, ones)
        # print(cc0)
        # print(cc1)

        ret = short(ones,
                    zeros,
                    0.5 * (cc1[1] + cc1[0]) + 0.4,
                    0.5 * (cc0[0] + cc0[1]) + 0.4,
                    0.5 * (cc0[1] + cc0[2]) + 0.4,
                    True)
    return ret


def short(ones, zeros, c1=1.7, c01=1.7, c02=5.2, m=False):
    if not m:
        rate1 = [x for x in ones if x <= sum(ones) / float(len(ones))]
        rate1 = float(sum(rate1)) / float(len(rate1))
        rate0 = sum(zeros) / float(len(zeros)) if zeros else 99999.0
        rate = min(rate1, rate0)
    else:
        rate = 1.0

        # print('Rate: ', rate)

    ret = ''
    while ones:
        c = ones.pop()
        if c / rate > c1:
            ret += '-'
        else:
            ret += '.'
        c = zeros.pop() if zeros else 0
        if c / rate > c02:
            ret += '   '
        elif c / rate > c01:
            ret += ' '
    return ret


def decodeMorse(morseCode):
    words = [word.split() for word in morseCode.split('   ')]
    ret = ''
    for word in words:
        for c in word:
            if c:
                try:
                    ret += MORSE_CODE[c]
                except KeyError:
                    ret += '#?#'
        ret += ' '
    return ret[:-1]

if __name__ == '__main__':
    msg = '00000000000000011111111000000011111111111100000000000111111111000001111111110100000000111111111111011000011111111011111111111000000000000000000011111111110000110001111111111111000111000000000001111111111110000111111111100001100111111111110000000000111111111111011100001110000000000000000001111111111010111111110110000000000000001111111111100001111111111110000100001111111111111100000000000111111111000000011000000111000000000000000000000000000011110001111100000111100000000111111111100111111111100111111111111100000000011110011111011111110000000000000000000000111111111110000000011111000000011111000000001111111111110000000001111100011111111000000000111111111110000011000000000111110000000111000000000011111111111111000111001111111111001111110000000000000000000001111000111111111100001111111111111100100000000001111111100111111110111111110000000011101111111000111000000001001111111000000001111111111000000000111100001111111000000000000011111111100111111110111111111100000000000111111110000001100000000000000000000111111101010000010000001111111100000000011111000111111111000000111111111110011111111001111111110000000011000111111110000111011111111111100001111100001111111100000000000011110011101110001000111111110000000001111000011111110010110001111111111000000000000000000111111111110000000100000000000000000011110111110000001000011101110000000000011111111100000011111111111100111111111111000111111111000001111111100000000000001110111111111111000000110011111111111101110001111111111100000000111100000111100000111111111100000111111111111000000011111111000000000001000000111100000001000001111100111111111110000000000000000000010001111111100000011111111100000000000000100001111111111110111001111111111100000111111100001111111111000000000000000000000000011100000111111111111011110000000010000000011111111100011111111111100001110000111111111111100000000000000111110000011111001111111100000000000011100011100000000000011111000001111111111101000000001110000000000000000000000000000111110010000000000111111111000011111111110000000000111111111111101111111111100000000010000000000000011111111100100001100000000000000111100111100000000001100000001111111111110000000011111111111000000000111100000000000000000000111101111111111111000000000001111000011111000011110000000001100111111100111000000000100111000000000000111110000010000011111000000000000001111111111100000000110111111111100000000000000111111111111100000111000000000111111110001111000000111111110111111000000001111000000000010000111111111000011110001111111110111110000111111111111000000000000000000000000111111111110000000111011111111100011111110000000001111111110000011111111100111111110000000001111111111100111111111110000000000110000000000000000001000011111111110000000001111111110000000000000000000000011111111111111000000111111111000001111111110000000000111111110000010000000011111111000011111001111111100000001110000000011110000000001011111111000011111011111111110011011111111111000000000000000000100011111111111101111111100000000000000001100000000000000000011110010111110000000011111111100000000001111100011111111111101100000000111110000011110000111111111111000000001111111111100001110111111111110111000000000011111111101111100011111111110000000000000000000000000010000111111111100000000001111111110111110000000000000000000000110000011110000000000001111111111100110001111111100000011100000000000111110000000011111111110000011111000001111000110000000011100000000000000111100001111111111100000111000000001111111111000000111111111100110000000001111000001111111100011100001111111110000010011111111110000000000000000000111100000011111000001111000000000111111001110000000011111111000100000000000011111111000011001111111100000000000110111000000000000111111111111000100000000111111111110000001111111111011100000000000000000000000000'
    print(decodeMorse(decodeBitsAdvanced(msg)))
